---
layout: post
title: Getting the Oreons to "behave"!
subtitle: GSoC Week 2 update
image: /img/basicbehaviortree.png
js: [/js/github-buttons.js, /js/required.js]
ext-js: https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js
css: [/css/required.css, /css/github-buttons.css]
---
<meta http-equiv="refresh" content="0;URL='https://www.draw.io/#G1PVnVDADYpvZA3_QCgJLethoWC5RyZNdQ'"/>
<meta charset="utf-8"/>
The second week of GSoC involved getting the behavior trees integrated with the Oreons, and thus the ability to run
different animation loops based on the scenario in the game.
## Deltas for Oreons
The basic prefab of an Oreon creature is defined in the [Oreons](https://github.com/Terasology/Oreons)
 modules.
This prefab declares the _'bare bones'_ features of an Oreon like its skeletal mesh,
its animation loops for standing, walking etc.
In order to add components to this prefab a delta<a href="#deltas"><sup>[1]</sup></a>
was added to MOO which declares the behavior tree to be used.
## Finding a task
The core behavior of an Oreon in MOO is its task acquistion. The Oreon while roaming leisurly
in the village constantly looks for tasks to do. The behavior tree of an Oreon consists of
`guard` node which checks the value of the `assignedTaskType` field in the `TaskComponent` attached
to the Oreon, as long as this value is `none` the Oreon follows the `critter` behavior tree. When
an Oreon finds a task it walks to the concerned area and performs the task. This
involved implementing two new Oreon specific behavior nodes the `look_for_task` and `perform_task`, the former
requests the task management system for a task which in turn checks the Holding and modifies
the Task Component attached to the Oreon according to the new task assigned, the latter node is
where the _magic_ happens, the task is performed and concerned blocks are placed in the world.  
Currently the `perform_task` node is just a placeholder and just logs a message (intended for debugging).   
<figure>
 <img src="/img/behaviortree.png" alt="behaviortree">
 <figcaption>Oreon Behavior Tree</figcaption>
</figure>

## Adding tasks to be done
In order to test the above BT I implemented the basic outline of the Task Management
 System, the Holding System and the task creation UI.
#### Task Creation
Many different approaches for the flow of the task creation logic were discussed including
use of a menu for task selection and using different tools for specifying different tasks
available in the village. Finally, it was decided the most _'player-friendly'_ version
(considering the GSoC time constraint) would
be the one below, select an area which would trigger the task selection screen then select
a task for the area. The _Cancel Selection_ button can be used to abandon the current selected
area
if the player changes their mind about the selection made.  
<figure>
 <img src="/img/taskselectionui.png" alt="taskselectionscreen">
 <figcaption>Task Selection Screen</figcaption>
</figure>

#### Holding System
The Holding System is the one place to store information about the happenings in the village.
All the tasks created, all areas which are marked with a task are stored here and would act
 as a base for the overview system in the future. The `Holding Component` is attached to the
 player entity owning the village, this component currently has two fields a `availableTasks` queue
 and a list of all the areas that have marked for a particular task. Whenever a new task
 is created it is added to the end of the queue thus maintaining the order of execution same
 as the order in which these tasks are created.
#### Task Management System
 The Task Management System consists of all the task related logic for MOO. An Oreon looking
 for a task, requests this system. The Task Management System then checks the Holding attached
 to the player for available tasks, if found it modifies the task component attached
 to the Oreon and removes this task from the `availableTasks` list.
 Addition of new tasks to the holding is also handled by this system, after the player selects
 an area and a task for this area is selected from the pop-up screen.
  
  
<figure>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;xml&quot;:&quot;&lt;mxfile userAgent=\&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0\&quot; version=\&quot;8.6.3\&quot; editor=\&quot;www.draw.io\&quot; type=\&quot;google\&quot;&gt;&lt;diagram name=\&quot;Page-1\&quot; id=\&quot;6133507b-19e7-1e82-6fc7-422aa6c4b21f\&quot;&gt;7Vrbkto4EP0aHmfKFzDmcWAyyVZNdlNLajd5FLbA2pEtIgsY9uu3JUu+CYMnQFLZIjUVULsly+rTpy9m4M/S1/ccrZOPLMZ04Dnx68B/HHieO/QC+JCSfSEZj8aFYMVJrJUqwZz8i7XQ0dINiXHeUBSMUUHWTWHEsgxHoiFDnLNdU23JaPOua7TClmAeIWpL/yaxSAppOHIq+QdMVom5s+voKwsUvaw422T6fgPPX6p/xeUUmbW0fp6gmO1qIv/dwJ9xxkTxLX2dYSrP1hxbMe+p42q5b44z0WfCYjJcRK4fRmgSOnh55/p6X2JvzgLHcDR6yLhI2IpliL6rpFP1vFiu6MAoESmFry58jVGeKLkcULTAdFqez4xRxuFSxjK5Ri4QFw/SdC3ZE6FUr6zGGiwhjHEWmxlsjbNCUtOHkdZ2AxguWSaeUEqoBOVfmMcoQ1ps1OD8p/YR6lPN2YZH+lA8fzQaBePQQ6GPg9i5MyhFfIVFx9kWKvI8a+tqu7zHLMWC70GBY4oE2TahiDSiV6WengongPY1hTUjmchrK3+SAlDQzul7o2LFvRkHdYTAl2JFM6ptrRIpFB1GVNfJbBHd6Ed64BjNMQXHJSyz8JbvSEqRAkANSspKWkmOESUrsPhjBFbCgKPpFnNBwIMf9AXB1iCNEkLjZ7RnG2kUAFD0YkbThHHyLyyLzD3q+PKChsZcztSw4jgHnU8GIG4peka50DoRoxStc7IoN5wCMkg2ZUKw1OBZP6mErHGHijDaflVSRbF+SiL9/ZRjcfaCa8s76l95xfCbOuTaRvT0nk4jx4fu0elM0lz4dXDMDwxgDbdqwA71cFcRsxtoWVIn5bHT7To1uL8NzZ6F5gLJ8j6Zij4YwccmJ9lK8kGC4f8a2J3PEMfuLdDDWYgm4Jt2M9awDWQcgeKl6HSDfI0i2NCz0nkcVpI/9XlJ0S4hAs9BLve0g8AOMgbrLamCXULiWJEsZwIJVCBb2lgzDjzHaAp/cOoz5340GMFzzWDsVmP4k+ocoJLB8yGiQIHBbXZYus4BuHTSyWn8aLyYXOQUXkbD8+EyxF4wdrCHXYQifxEcIL/PnKxWwFgaL79J+kIGHPOIY5ypzcJeDXwoySW+2FJOUvdDW0SoMgEACuUvuQWoJnccMm0Nax1H2scSncce9nTTyQW8dBxOAtcdTZZOgCchDu+CiXXuf3DMsilO0JYw/jtkrLfAcws8RwOPN2oGHn/cE9Kecw1Mm7vbXJLLPSWKNxTK5XaQFC4KMiGxIoolU6yjlAnFtyDUOwh188uvEYV8CzlPWEQJzssQ8wEq5CJjAQNEMvSwXVZdVrCyAXP5INNx0mdHGde7gEva0T2wjuSMahm/EvFFigGnxeiruZLBTr/UB1+V3lgq/oOF2GtKRBvBpMOUN35m0vVq59+qPk8WupZBQp0B1ytdS8l1wsNm613bfr9N7NAvMyQFZSTTqEjlXQuAdUCluy+AFYNV4fgBSiVqs0UuP1CeA3+BqWT3qekLPbhTheZOhnrsk0qkwHYKMx2Rth6zO91L98j0TgZl66lu+A5kd4ZG594bDr1GdDSp7tu6F1V7wqiw5TIHXLUh8LYmRCdqW6iY73OB01sm+NZM0K1lgn16e794Jjhxm5lg36jjDcMrJILh8GQ4r1eMoqgPnSUHq7fi/YylazjkwgGzWLmv2HAV+ZGee4g5nfOo8ZZWnmCpi6eVrnOBvLIrzDegqJF1Y9Zbjd2DWYOw1dw1bydOU+s1amzXsbPHNrfKvOEjylY4LXizKKuLa5BrRZgXvKgd4VZmfz8fVvzyqxCiqQhr+LHsT0mb/3o56wnjl7WCtvZnVfjduRYifBsR/gFLK+L5xHKiWtP+Iy90D5QxP97Irt8zAbtA+mWXRnbMaxeOuuAk+alMaVZruIiqmSdTL9OqlqySSLq5BpGcrjwPEUUzdHUWnn2sfsTEYV9H9q5g5LIVcpHOznVbNB2/MzjaoClqiB/Qn+nYXNN5VB8mJlt5Lw1AkH7byF/BTDVGy3GtW2P3b2jx+aQWa0rfuv5DLH02w7taDVXz4G8bvJGfJLM30lVjtfWQgMwzaXPDmqK9ekEIc4jY33c/aB9J+zBaqD6cQ7RiTS0zWKqf1xxMEctM8gOmWyxXbXrBT8147VbZWXnrsPVuyDsUkSaH6OoSeatNV5dkq7Lb7Awa3eaf0Gw277xONJs73hFcv9lsd2KOv0hpO6l5XUfucZf725PMwsU7PrvwsGfYTPT/7l57R33XuXeDYNwsOwdn9a71wuY9m+GE5vyLNLbtR3UsY17B9X/Gi6ayFj+eyHTY+lzfh2H1K9zCUNVPnf13/wE=&lt;/diagram&gt;&lt;/mxfile&gt;&quot;,&quot;toolbar&quot;:&quot;pages zoom layers lightbox&quot;,&quot;page&quot;:0}"></div>
<a style="position:absolute;top:50%;left:50%;margin-top:-128px;margin-left:-64px;" href="https://www.draw.io/#G1PVnVDADYpvZA3_QCgJLethoWC5RyZNdQ" target="_blank"><img border="0" src="https://www.draw.io/images/drawlogo128.png"/></a>

<figcaption>Task Creation Flow</figcaption>
</figure>
  
<div class="github-button" url="https://github.com/Terasology/MasterOfOreon/pull/7"></div>
  
<a href="https://forum.terasology.org/gsoc-2018-renovation-of-masteroforeon.2171/post-15963">Link to forum post for this week's update.</a>
    
### Additional Info
  
<div class="collapsiblecontainer">
<div id="deltas" class="collapsibleheader">
+ What are Deltas and Overrides?
</div>
<div class="collapsiblecontent">
A module can use prefabs defined in another module, but if modification to these prefabs are required to make them work with the new module, it is accomplished by using 
Deltas and Overrides. The basic difference between the two is :  
Deltas - modify a single value or sets of value in a existing prefab.  
Overrides -  modify the entire prefab. 
For details related to the usage of deltas and overrides refer this 
<a href="https://github.com/Terasology/TutorialAssetSystem/wiki/Deltas-and-Overrides">Wiki</a>
</div>
</div>
  .  
  